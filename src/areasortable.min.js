/**
*  area-sortable.js
*  A simple js class to sort elements of an area using drag-and-drop (desktop and mobile)
*  @VERSION: 1.0.0
*
*  https://github.com/foo123/area-sortable.js
*
**/
!function(e,t,n){"use strict";var o;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(e.EXPORTED_SYMBOLS=[t],e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=o=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return o})}("undefined"!=typeof self?self:this,"AreaSortable",function(e){"use strict";var O="$dndSortable",P=1,j=2,q=P+j,A=Math,D=String,t=Object.prototype.hasOwnProperty,n=/^\s+|\s+$/g,o=D.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(n,"")};function X(e,t){return e.classList?e.classList.contains(t):-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function Y(e,t){e.classList?e.classList.add(t):X(e,t)||(e.className=""===e.className?t:e.className+" "+t)}function k(e,t){e.classList?e.classList.remove(t):e.className=o((" "+e.className+" ").replace(" "+t+" "," "))}function M(e,t,n,o){e=e.getBoundingClientRect(),t=t.getBoundingClientRect();return A.max(0,A.min(1,A.max(0,A.min(e[n]+e[o],t[n]+t[o])-A.max(e[n],t[n]))/A.min(e[o],t[o])))}function V(e,t,n,o){var r=e.getBoundingClientRect(),c=t.getBoundingClientRect(),e=0,t=0,e=A.max(0,A.min(r.left+r.width,c.left+c.width)-A.max(r.left,c.left)),t=A.max(0,A.min(r.top+r.height,c.top+c.height)-A.max(r.top,c.top));return A.max(0,A.min(1,e*t/(A.min(r.width,c.width)*A.min(r.height,c.height))))}function $(n,e){return e.reduce(function(e,t){return e[t]=n.style.getPropertyValue(t),e},{})}function z(t,e,n){n=n||t[O].style,e.forEach(function(e){""!==n[e]?t.style[e]=n[e]:t.style.removeProperty(e)})}function r(p,d){function n(){c=i=r=m=h=f=a=t=u=null,b=!1}function e(e){L||(n(),(t=e.target)&&X(t,p.opts.handle||"dnd-sortable-handle")&&(u=t.closest("."+(p.opts.item||"dnd-sortable-item")))&&(m=u.parentNode)&&m.id===p.opts.container?(L=!0,e.preventDefault(),e.stopPropagation(),i=m.getBoundingClientRect(),c=$(m,["width","height"]),(r=[].map.call(m.children,function(e,t){var n=e.getBoundingClientRect();return e[O]={index:t,rect:{top:n.top,left:n.left,width:n.width,height:n.height,prev:{}},style:$(e,["position","top","left","width","height"])},e})).length&&(f=r[0],h=r[r.length-1]),Y(m,p.opts.activeArea||"dnd-sortable-area"),m.style.width=D(i.width)+"px",m.style.height=D(i.height)+"px",u.draggable=!1,Y(u,p.opts.activeItem||"dnd-sortable-dragged"),r.forEach(function(e){e.style.position="absolute",e.style.top=D(e[O].rect.top-i.top)+"px",e.style.left=D(e[O].rect.left-i.left)+"px",e.style.width=D(e[O].rect.width)+"px",e.style.height=D(e[O].rect.height)+"px"}),"function"==typeof p.opts.onStart&&p.opts.onStart(u),x=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientX,y=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientY,g=x+i.left-u[O].rect.left,v=y+i.top-u[O].rect.top,q===d?(u.style.top=D(y-v)+"px",u.style.left=D(x-g)+"px"):u.style[T]=D(j===d?x-g:y-v)+"px",document.addEventListener("touchmove",N,!1),document.addEventListener("touchend",R,!1),document.addEventListener("touchcancel",R,!1),document.addEventListener("mousemove",N,!1),document.addEventListener("mouseup",R,!1)):n())}function o(){L&&(document.removeEventListener("touchmove",N,!1),document.removeEventListener("touchend",R,!1),document.removeEventListener("touchcancel",R,!1),document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",R,!1),k(m,p.opts.activeArea||"dnd-sortable-area"),z(m,["width","height"],c),a&&k(a,p.opts.closestItem||"dnd-sortable-closest"),k(u,p.opts.activeItem||"dnd-sortable-dragged"),r.forEach(function(e){z(e,["position","top","left","width","height"]),e[O]=null}),L=!1)}var u,t,a,f,h,m,r,i,c,g,v,x,y,E,b,l,s,w,L=!1,S=!1,C=j===d?"width":"height",T=j===d?"left":"top",B=q===d?function(e,t,n){var o,r;if(f!==h)if(n<0){for(r=e.nextElementSibling,f===t&&(f=e),h===e&&(h=e.previousElementSibling),m.insertBefore(e,t),e[O].index=t[O].index,e[O].rect.prev.top=e[O].rect.top,e[O].rect.prev.left=e[O].rect.left,e[O].rect.top=t[O].rect.top,e[O].rect.left=t[O].rect.left;(o=t.nextElementSibling)&&o!==r;)t[O].index++,t[O].rect.top=o[O].rect.top,t[O].rect.left=o[O].rect.left,t.style.top=D(t[O].rect.top-i.top)+"px",t.style.left=D(t[O].rect.left-i.left)+"px",t=o;t[O].index++,t[O].rect.top=e[O].rect.prev.top,t[O].rect.left=e[O].rect.prev.left,t.style.top=D(t[O].rect.top-i.top)+"px",t.style.left=D(t[O].rect.left-i.left)+"px"}else if(0<n){for(r=e.nextElementSibling,f===e&&(f=r),t.nextElementSibling?m.insertBefore(e,t.nextElementSibling):(m.appendChild(e),h=e),e[O].index=t[O].index,t=r,(o=e)[O].rect.prev.top=o[O].rect.top,o[O].rect.prev.left=o[O].rect.left;t[O].index--,t[O].rect.prev.top=t[O].rect.top,t[O].rect.prev.left=t[O].rect.left,t[O].rect.top=o[O].rect.prev.top,t[O].rect.left=o[O].rect.prev.left,t.style.top=D(t[O].rect.top-i.top)+"px",t.style.left=D(t[O].rect.left-i.left)+"px",(t=(o=t).nextElementSibling)&&t!==e;);e[O].rect.top=o[O].rect.prev.top,e[O].rect.left=o[O].rect.prev.left}}:function(e,t,n){var o,r,c=0;if(f!==h)if(n<0){for(r=e.nextElementSibling,f===t&&(f=e),h===e&&(h=e.previousElementSibling),m.insertBefore(e,t),e[O].index=t[O].index,e[O].rect.prev[T]=e[O].rect[T],e[O].rect[T]=t[O].rect[T],c=e[O].rect[C]-t[O].rect[C];(o=t.nextElementSibling)&&o!==r;)t[O].index++,t[O].rect[T]=o[O].rect[T]+c,t.style[T]=D(t[O].rect[T]-i[T])+"px",c+=t[O].rect[C]-o[O].rect[C],t=o;t[O].index++,t[O].rect[T]=e[O].rect.prev[T]+c,t.style[T]=D(t[O].rect[T]-i[T])+"px"}else if(0<n){for(r=e.nextElementSibling,f===e&&(f=r),t.nextElementSibling?m.insertBefore(e,t.nextElementSibling):(m.appendChild(e),h=e),e[O].index=t[O].index,t=r,c=0,(o=e)[O].rect.prev[T]=o[O].rect[T];t[O].index--,t[O].rect.prev[T]=t[O].rect[T],t[O].rect[T]=o[O].rect.prev[T]+c,t.style[T]=D(t[O].rect[T]-i[T])+"px",c+=-(o[O].rect[C]-t[O].rect[C]),(t=(o=t).nextElementSibling)&&t!==e;);e[O].rect[T]=o[O].rect.prev[T]+c}},I=q===d?V:M,N=(l=function(e){var t,n,o,r,c,i=0,l="left",s="width";P===d&&(l="top",s="height"),n=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientX,t=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientY,o=n-x,r=t-y,(e=document.elementsFromPoint(n,t).reduce(function(e,t){var n;return t!==u&&t.parentNode===m&&(n=I(u,t,T,C),i<n&&(i=n,e=t)),e},null))||(c=u.getBoundingClientRect()[l]),r=q===d?(!e&&u!==f&&0<=f[O].rect[l]-(c+u[O].rect[s])&&f[O].rect[l]-(c+u[O].rect[s])<50&&.7<(i=M(u,f,"top","height"))&&(e=f),!e&&u!==h&&0<=c-(h[O].rect[l]+h[O].rect[s])&&c-(h[O].rect[l]+h[O].rect[s])<50&&.7<(i=M(u,h,"top","height"))&&(e=h),u.style.top=D(t-v)+"px",u.style.left=D(n-g)+"px",e?e[O].index-u[O].index:A.abs(r)>=A.abs(o)?r:o):(!e&&u!==f&&f[O].rect[l]>c+u[O].rect[s]&&(e=f),!e&&u!==h&&c>h[O].rect[l]+h[O].rect[s]&&(e=h),j===d?(u.style[T]=D(n-g)+"px",o):(u.style[T]=D(t-v)+"px",r)),a&&(E<0&&0<r||0<E&&r<0||e&&a!==e||!I(u,a,T,C))&&(k(a,p.opts.closestItem||"dnd-sortable-closest"),a=null),!a&&e&&i&&(a=e,E=0<r?1:-1,b=!1),x=n,y=t,a&&((i=i||I(u,a,T,C))?.3<=i?(Y(a,p.opts.closestItem||"dnd-sortable-closest"),.5<i&&!b&&(b=!0,B(u,a,E),k(a,p.opts.closestItem||"dnd-sortable-closest"),a=null)):(k(a,p.opts.closestItem||"dnd-sortable-closest"),a=null):(k(a,p.opts.closestItem||"dnd-sortable-closest"),a=null,b=!1))},w=!(s=60),function(){var e=arguments;w||(l.apply(this,e),w=!0,setTimeout(function(){w=!1},s))}),R=function(e){var t=u;o(),n(),"function"==typeof p.opts.onEnd&&p.opts.onEnd(t)};p.start=function(){S||(S=!0,n(),document.addEventListener("touchstart",e,!0),document.addEventListener("mousedown",e,!0))},p.stop=function(){S&&(S=!1,document.removeEventListener("touchstart",e,!0),document.removeEventListener("mousedown",e,!0),o(),n())}}function c(e,t){var n=this;if(!(n instanceof c))return new c(e,t);switch(n.opts=t||{},D(e||"vertical").toLowerCase()){case"unrestricted":r(n,q);break;case"horizontal":r(n,j);break;default:r(n,P)}n.start()}return window.Element&&!t.call(window.Element.prototype,O)&&(window.Element.prototype[O]=null),c.VERSION="1.0.0",c.prototype={constructor:c,opts:null,start:null,stop:null,dispose:function(){var e=this;return e.stop&&e.stop(),e.opts=null,e.start=null,e.stop=null,e}},c});