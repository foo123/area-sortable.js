/**
*  area-sortable.js
*  A simple js class to sort elements of an area using drag-and-drop (desktop and mobile)
*  @VERSION: 1.0.0
*
*  https://github.com/foo123/area-sortable.js
*
**/
!function(t,e){"use strict";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(function(t){return e()}):t.AreaSortable=e()}("undefined"!=typeof self?self:this,function(t){"use strict";var A=window.document,F="$dndSortable",R=1,j=2,k=R+j,D=Math,M=String,o=Object.prototype.hasOwnProperty,e=/^\s+|\s+$/g,V=/mousedown|pointerdown/,n=M.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(e,"")};function $(t,e){return t.classList?t.classList.contains(e):-1!==(" "+t.className+" ").indexOf(" "+e+" ")}function W(t,e){t.classList?t.classList.add(e):$(t,e)||(t.className=""===t.className?e:t.className+" "+e)}function q(t,e){t.classList?t.classList.remove(e):t.className=n((" "+t.className+" ").replace(" "+e+" "," "))}function G(t,e,n,o){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener(e,n,!!o)}function H(t,e,n,o){t.detachEvent?t.detachEvent("on"+e,n):t.removeEventListener(e,n,!!o)}function J(t,e){return A.elementsFromPoint(t,e)}function K(t,e,n,o){t=t[F].r,e=e[F].rect;return D.max(0,D.min(1,D.max(0,D.min(t[n]+t[o],e[n]+e[o])-D.max(t[n],e[n]))/D.min(t[o],e[o])))}function Q(t,e,n,o){var r=t[F].r,i=e[F].rect,t=0,e=0,t=D.max(0,D.min(r.left+r.width,i.left+i.width)-D.max(r.left,i.left)),e=D.max(0,D.min(r.top+r.height,i.top+i.height)-D.max(r.top,i.top));return D.max(0,D.min(1,t*e/(D.min(r.width,i.width)*D.min(r.height,i.height))))}function U(n,t){return t.reduce(function(t,e){return t[e]=n.style.getPropertyValue(e),t},{})}function Z(e,t,n){n=n||e[F].style,t.forEach(function(t){o.call(n,t)&&""!==n[t]?e.style[t]=n[t]:e.style.removeProperty(t)})}function _(e,t,n){var o,r,i,c;return 0<t&&(e[F].animation&&e[F].animation.stop(),o="transform "+M(t)+"ms",r="translate3d(0,0,0)",i=null,c=function t(){return i&&clearTimeout(i),i=null,e[F]&&e[F].animation&&t===e[F].animation.stop&&(e[F].animation=null),e.style.transform===r&&e.style.transition===o&&(e.style.transition="none",e.style.transform="none"),e},e.style.transition="none",e.style.transform="translate3d("+M(-(n.left||0))+"px,"+M(-(n.top||0))+"px,0)",e.offsetWidth,e.style.transform=r,e.style.transition=o,i=setTimeout(c,t),e[F].animation={stop:c}),e}function r(d,u){function n(){i=y=r=v=x=g=m=e=h=null,P=!1,N=0}function t(t){!a&&d.opts.container&&(V.test(t.type)&&0!==t.button||(n(),!(e=t.target)||!$(e,d.opts.handle||"dnd-sortable-handle")||!(h=function(t,e){if(t.closest)return t.closest("."+e);for(;t;){if($(t,e))return t;t=t.parentNode}}(e,d.opts.item||"dnd-sortable-item"))||!(v=h.parentNode)||"string"==typeof d.opts.container&&v.id!==d.opts.container||"string"!=typeof d.opts.container&&v!==d.opts.container?n():("function"==typeof d.opts.onStart&&d.opts.onStart(h),"function"!=typeof d.opts.itemFilter||(h=d.opts.itemFilter(h))?(a=!0,t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),X(),E=window.scrollX,S=window.scrollY,T=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientX,I=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientY,w=T+y.left-h[F].rect.left,b=I+y.top-h[F].rect.top,k===u?(h.style.top=M(I-b)+"px",h.style.left=M(T-w)+"px"):h.style[B]=M(j===u?T-w:I-b)+"px"):n())))}function o(){a&&(H(A,"touchmove",f,!1),H(A,"touchend",Y,!1),H(A,"touchcancel",Y,!1),H(A,"mousemove",f,!1),H(A,"mouseup",Y,!1),q(v,d.opts.activeArea||"dnd-sortable-area"),Z(v,["width","height","box-sizing"],i),m&&q(m,d.opts.closestItem||"dnd-sortable-closest"),q(h,d.opts.activeItem||"dnd-sortable-dragged"),r.forEach(function(t){Z(t,["position","box-sizing","overflow","margin","margin-top","margin-left","margin-right","margin-bottom","top","left","width","height","transform","transition"]),t[F]=null}),a=!1)}var h,e,m,g,x,v,r,y,i,w,b,E,S,T,I,L,N,P,c,l,s,a=!1,p=!1,z=j===u?"width":"height",B=j===u?"left":"top",C=k===u?function(t,e,n,o){var r,i,c=e;if(g!==x)if(n<0){for(i=t.nextElementSibling,g===e&&(g=t),x===t&&(x=t.previousElementSibling),v.insertBefore(t,e),t[F].index=e[F].index,t[F].rect.prev.top=t[F].rect.top,t[F].rect.prev.left=t[F].rect.left,t[F].rect.top=e[F].rect.top,t[F].rect.left=e[F].rect.left;(r=e.nextElementSibling)&&r!==i;)e[F].animation&&e[F].animation.stop(),e[F].index++,e[F].rect.prev.top=e[F].rect.top,e[F].rect.prev.left=e[F].rect.left,e[F].rect.top=r[F].rect.top,e[F].rect.left=r[F].rect.left,e.style.top=M(e[F].rect.top-y.top)+"px",e.style.left=M(e[F].rect.left-y.left)+"px",e=r;e[F].animation&&e[F].animation.stop(),e[F].index++,e[F].rect.prev.top=e[F].rect.top,e[F].rect.prev.left=e[F].rect.left,e[F].rect.top=t[F].rect.prev.top,e[F].rect.left=t[F].rect.prev.left,e.style.top=M(e[F].rect.top-y.top)+"px",e.style.left=M(e[F].rect.left-y.left)+"px",_(c,o,{top:c[F].rect.top-c[F].rect.prev.top,left:c[F].rect.left-c[F].rect.prev.left})}else if(0<n){for(i=t.nextElementSibling,g===t&&(g=i),e.nextElementSibling?v.insertBefore(t,e.nextElementSibling):(v.appendChild(t),x=t),t[F].index=e[F].index,e=i,(r=t)[F].rect.prev.top=r[F].rect.top,r[F].rect.prev.left=r[F].rect.left;e[F].animation&&e[F].animation.stop(),e[F].index--,e[F].rect.prev.top=e[F].rect.top,e[F].rect.prev.left=e[F].rect.left,e[F].rect.top=r[F].rect.prev.top,e[F].rect.left=r[F].rect.prev.left,e.style.top=M(e[F].rect.top-y.top)+"px",e.style.left=M(e[F].rect.left-y.left)+"px",(e=(r=e).nextElementSibling)&&e!==t;);t[F].rect.top=r[F].rect.prev.top,t[F].rect.left=r[F].rect.prev.left,_(c,o,{top:c[F].rect.top-c[F].rect.prev.top,left:c[F].rect.left-c[F].rect.prev.left})}}:function(t,e,n,o){var r,i,c,l=e,s=0;if(g!==x)if(n<0){for(i=t.nextElementSibling,g===e&&(g=t),x===t&&(x=t.previousElementSibling),v.insertBefore(t,e),t[F].index=e[F].index,t[F].rect.prev[B]=t[F].rect[B],t[F].rect[B]=e[F].rect[B],s=t[F].rect[z]-e[F].rect[z];(r=e.nextElementSibling)&&r!==i;)e[F].animation&&e[F].animation.stop(),e[F].index++,e[F].rect.prev[B]=e[F].rect[B],e[F].rect[B]=r[F].rect[B]+s,e.style[B]=M(e[F].rect[B]-y[B])+"px",s+=e[F].rect[z]-r[F].rect[z],e=r;e[F].animation&&e[F].animation.stop(),e[F].index++,e[F].rect.prev[B]=e[F].rect[B],e[F].rect[B]=t[F].rect.prev[B]+s,e.style[B]=M(e[F].rect[B]-y[B])+"px",(c={})[B]=l[F].rect[B]-l[F].rect.prev[B],_(l,o,c)}else if(0<n){for(i=t.nextElementSibling,g===t&&(g=i),e.nextElementSibling?v.insertBefore(t,e.nextElementSibling):(v.appendChild(t),x=t),t[F].index=e[F].index,e=i,s=0,(r=t)[F].rect.prev[B]=r[F].rect[B];e[F].animation&&e[F].animation.stop(),e[F].index--,e[F].rect.prev[B]=e[F].rect[B],e[F].rect[B]=r[F].rect.prev[B]+s,e.style[B]=M(e[F].rect[B]-y[B])+"px",s+=-(r[F].rect[z]-e[F].rect[z]),(e=(r=e).nextElementSibling)&&e!==t;);t[F].rect[B]=r[F].rect.prev[B]+s,(c={})[B]=l[F].rect[B]-l[F].rect.prev[B],_(l,o,c)}},O=k===u?Q:K,f=(c=function(t){var e,n,o,r,i,c,l=0,s=window.scrollX,a=window.scrollY,p="left",f="width";R===u&&(p="top",f="height"),n=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientX,e=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientY,o=n-T,r=e-I,h[F].r.top=e-b-(a-S)+y.top,h[F].r.left=n-w-(s-E)+y.left,i=s+h[F].r.left+h[F].r.width/2,c=a+h[F].r.top+h[F].r.height/2,t=h[F].r[p],a=J(n,e).concat(R===u?[]:J(s+h[F].r.left+2,c)).concat(R===u?[]:J(s+h[F].r.left+h[F].r.width-2,c)).concat(j===u?[]:J(i,a+h[F].r.top+2)).concat(j===u?[]:J(i,a+h[F].r.top+h[F].r.height-2)).reduce(function(t,e){var n;return e!==h&&e.parentNode===v&&(n=O(h,e,B,z),l<n&&(l=n,t=e)),t},null),r=k===u?(!a&&h!==g&&0<=g[F].rect[p]-(t+h[F].rect[f])&&g[F].rect[p]-(t+h[F].rect[f])<50&&.7<(l=K(h,g,"top","height"))&&(a=g),!a&&h!==x&&0<=t-(x[F].rect[p]+x[F].rect[f])&&t-(x[F].rect[p]+x[F].rect[f])<50&&.7<(l=K(h,x,"top","height"))&&(a=x),h.style.top=M(e-b)+"px",h.style.left=M(n-w)+"px",a?a[F].index-h[F].index:D.abs(r)>=D.abs(o)?r:o):(!a&&h!==g&&g[F].rect[p]>t+h[F].rect[f]&&(a=g),!a&&h!==x&&t>x[F].rect[p]+x[F].rect[f]&&(a=x),j===u?(h.style[B]=M(n-w)+"px",o):(h.style[B]=M(e-b)+"px",r)),m&&(L<0&&0<r&&N<.5||0<L&&r<0&&N<.5||a&&m!==a&&N<l||!O(h,m,B,z))&&(q(m,d.opts.closestItem||"dnd-sortable-closest"),N=0,m=null),!m&&a&&l&&(m=a,L=0<r?1:-1,N=l,P=!1),T=n,I=e,m&&((l=l||O(h,m,B,z))?.3<=(N=l)?(W(m,d.opts.closestItem||"dnd-sortable-closest"),.5<l&&!P&&(P=!0,C(h,m,L,d.opts.animationMs||0))):q(m,d.opts.closestItem||"dnd-sortable-closest"):(q(m,d.opts.closestItem||"dnd-sortable-closest"),N=0,m=null))},s=!(l=60),function(){var t=arguments;s||(c.apply(this,t),s=!0,setTimeout(function(){s=!1},l))}),X=function(){y=v.getBoundingClientRect(),i=U(v,["width","height","box-sizing"]),(r=[].map.call(v.children,function(t,e){var n=t.getBoundingClientRect(),o=window.getComputedStyle(t),r=parseInt(o.marginTop)||0,o=parseInt(o.marginLeft)||0;return t[F]={index:e,rect:{top:n.top-r,left:n.left-o,width:n.width,height:n.height,prev:{}},r:{top:n.top,left:n.left,width:n.width,height:n.height},style:U(t,["position","box-sizing","overflow","margin","margin-top","margin-left","margin-right","margin-bottom","top","left","width","height","transform","transition"]),animation:null},t})).length&&(g=r[0],x=r[r.length-1]),W(v,d.opts.activeArea||"dnd-sortable-area"),v.style.boxSizing="border-box",v.style.width=M(y.width)+"px",v.style.height=M(y.height)+"px",h.draggable=!1,W(h,d.opts.activeItem||"dnd-sortable-dragged"),r.forEach(function(t){t.style.position="absolute",t.style.boxSizing="border-box",t.style.overflow="hidden",t.style.top=M(t[F].rect.top-y.top)+"px",t.style.left=M(t[F].rect.left-y.left)+"px",t.style.width=M(t[F].rect.width)+"px",t.style.height=M(t[F].rect.height)+"px"}),G(A,"touchmove",f,!1),G(A,"touchend",Y,!1),G(A,"touchcancel",Y,!1),G(A,"mousemove",f,!1),G(A,"mouseup",Y,!1)},Y=function(t){var e=h;o(),n(),"function"==typeof d.opts.onEnd&&d.opts.onEnd(e)};d.start=function(){p||(p=!0,n(),G(A,"touchstart",t,!0),G(A,"mousedown",t,!0))},d.stop=function(){p&&(H(A,"touchstart",t,!(p=!1)),H(A,"mousedown",t,!0),o(),n())}}function i(t,e){var n=this;if(!(n instanceof i))return new i(t,e);switch(n.opts=e||{},M(t||"vertical").toLowerCase()){case"unrestricted":r(n,k);break;case"horizontal":r(n,j);break;default:r(n,R)}n.start()}return window.Element&&!o.call(window.Element.prototype,F)&&(window.Element.prototype[F]=null),i.VERSION="1.0.0",i.prototype={constructor:i,opts:null,start:null,stop:null,dispose:function(){var t=this;return t.stop&&t.stop(),t.opts=null,t.start=null,t.stop=null,t}},i});