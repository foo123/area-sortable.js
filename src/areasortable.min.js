/**
*  area-sortable.js
*  A simple js class to sort elements of an area using drag-and-drop (desktop and mobile)
*  @VERSION: 1.0.0
*
*  https://github.com/foo123/area-sortable.js
*
**/
!function(t,e){"use strict";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(function(t){return e()}):t.AreaSortable=e()}("undefined"!=typeof self?self:this,function(t){"use strict";var R=window.document,A="$dndSortable",X=1,Y=2,j=X+Y,k=Math,M=String,o=Object.prototype.hasOwnProperty,e=/^\s+|\s+$/g,V=/mousedown|pointerdown/,n=M.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(e,"")};function $(t,e){return t.classList?t.classList.contains(e):-1!==(" "+t.className+" ").indexOf(" "+e+" ")}function D(t,e){t.classList?t.classList.add(e):$(t,e)||(t.className=""===t.className?e:t.className+" "+e)}function F(t,e){t.classList?t.classList.remove(e):t.className=n((" "+t.className+" ").replace(" "+e+" "," "))}function W(t,e,n,o){t.addEventListener(e,n,!!o)}function q(t,e,n,o){t.removeEventListener(e,n,!!o)}function G(t,e){return R.elementsFromPoint(t,e)}function H(t,e,n,o){t=t[A].r,e=e[A].rect;return k.max(0,k.min(1,k.max(0,k.min(t[n]+t[o],e[n]+e[o])-k.max(t[n],e[n]))/k.min(t[o],e[o])))}function J(t,e,n,o){var r=t[A].r,i=e[A].rect,t=0,e=0,t=k.max(0,k.min(r.left+r.width,i.left+i.width)-k.max(r.left,i.left)),e=k.max(0,k.min(r.top+r.height,i.top+i.height)-k.max(r.top,i.top));return k.max(0,k.min(1,t*e/(k.min(r.width,i.width)*k.min(r.height,i.height))))}function K(n,t){return t.reduce(function(t,e){return t[e]=n.style.getPropertyValue(e),t},{})}function Q(e,t,n){n=n||e[A].style,t.forEach(function(t){o.call(n,t)&&""!==n[t]?e.style[t]=n[t]:e.style.removeProperty(t)})}function U(e,t,n){var o,r,i;0<t&&(e[A].animation&&e[A].animation.stop(),e.style.transition="none",e.style.transform="translate3d("+M(-(n.left||0))+"px,"+M(-(n.top||0))+"px,0)",e.offsetWidth,o="transform "+M(t)+"ms",r="translate3d(0,0,0)",e.style.transform=r,e.style.transition=o,n=function t(){return i&&clearTimeout(i),i=null,e[A]&&e[A].animation&&t===e[A].animation.stop&&(e[A].animation=null),e.style.transition===o&&(e.style.transition="none"),e.style.transform===r&&(e.style.transform="none"),e},i=setTimeout(n,t),e[A].animation={stop:n})}function r(d,u){function n(){i=a=r=v=x=g=m=e=h=null,I=!1,T=0}function t(t){p||V.test(t.type)&&0!==t.button||(n(),(e=t.target)&&$(e,d.opts.handle||"dnd-sortable-handle")&&(h=function(t,e){if(t.closest)return t.closest("."+e);for(;t;){if($(t,e))return t;t=t.parentNode}}(e,d.opts.item||"dnd-sortable-item"))&&(v=h.parentNode)&&v.id===d.opts.container?(p=!0,t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),"function"==typeof d.opts.onStart&&d.opts.onStart(h),C(),w=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientX,E=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientY,y=w+a.left-h[A].rect.left,b=E+a.top-h[A].rect.top,j===u?(h.style.top=M(E-b)+"px",h.style.left=M(w-y)+"px"):h.style[L]=M(Y===u?w-y:E-b)+"px"):n())}function o(){p&&(q(R,"touchmove",B,!1),q(R,"touchend",O,!1),q(R,"touchcancel",O,!1),q(R,"mousemove",B,!1),q(R,"mouseup",O,!1),F(v,d.opts.activeArea||"dnd-sortable-area"),Q(v,["width","height","box-sizing"],i),m&&F(m,d.opts.closestItem||"dnd-sortable-closest"),F(h,d.opts.activeItem||"dnd-sortable-dragged"),r.forEach(function(t){Q(t,["position","box-sizing","overflow","top","left","width","height","transform","transition"]),t[A]=null}),p=!1)}var h,e,m,g,x,v,r,a,i,y,b,w,E,S,T,I,c,l,s,p=!1,f=!1,N=Y===u?"width":"height",L=Y===u?"left":"top",P=j===u?function(t,e,n,o){var r,i,c=e;if(g!==x)if(n<0){for(i=t.nextElementSibling,g===e&&(g=t),x===t&&(x=t.previousElementSibling),v.insertBefore(t,e),t[A].index=e[A].index,t[A].rect.prev.top=t[A].rect.top,t[A].rect.prev.left=t[A].rect.left,t[A].rect.top=e[A].rect.top,t[A].rect.left=e[A].rect.left;(r=e.nextElementSibling)&&r!==i;)e[A].animation&&e[A].animation.stop(),e[A].index++,e[A].rect.prev.top=e[A].rect.top,e[A].rect.prev.left=e[A].rect.left,e[A].rect.top=r[A].rect.top,e[A].rect.left=r[A].rect.left,e.style.top=M(e[A].rect.top-a.top)+"px",e.style.left=M(e[A].rect.left-a.left)+"px",e=r;e[A].animation&&e[A].animation.stop(),e[A].index++,e[A].rect.prev.top=e[A].rect.top,e[A].rect.prev.left=e[A].rect.left,e[A].rect.top=t[A].rect.prev.top,e[A].rect.left=t[A].rect.prev.left,e.style.top=M(e[A].rect.top-a.top)+"px",e.style.left=M(e[A].rect.left-a.left)+"px",U(c,o,{top:c[A].rect.top-c[A].rect.prev.top,left:c[A].rect.left-c[A].rect.prev.left})}else if(0<n){for(i=t.nextElementSibling,g===t&&(g=i),e.nextElementSibling?v.insertBefore(t,e.nextElementSibling):(v.appendChild(t),x=t),t[A].index=e[A].index,e=i,(r=t)[A].rect.prev.top=r[A].rect.top,r[A].rect.prev.left=r[A].rect.left;e[A].animation&&e[A].animation.stop(),e[A].index--,e[A].rect.prev.top=e[A].rect.top,e[A].rect.prev.left=e[A].rect.left,e[A].rect.top=r[A].rect.prev.top,e[A].rect.left=r[A].rect.prev.left,e.style.top=M(e[A].rect.top-a.top)+"px",e.style.left=M(e[A].rect.left-a.left)+"px",(e=(r=e).nextElementSibling)&&e!==t;);t[A].rect.top=r[A].rect.prev.top,t[A].rect.left=r[A].rect.prev.left,U(c,o,{top:c[A].rect.top-c[A].rect.prev.top,left:c[A].rect.left-c[A].rect.prev.left})}}:function(t,e,n,o){var r,i,c,l=e,s=0;if(g!==x)if(n<0){for(i=t.nextElementSibling,g===e&&(g=t),x===t&&(x=t.previousElementSibling),v.insertBefore(t,e),t[A].index=e[A].index,t[A].rect.prev[L]=t[A].rect[L],t[A].rect[L]=e[A].rect[L],s=t[A].rect[N]-e[A].rect[N];(r=e.nextElementSibling)&&r!==i;)e[A].animation&&e[A].animation.stop(),e[A].index++,e[A].rect.prev[L]=e[A].rect[L],e[A].rect[L]=r[A].rect[L]+s,e.style[L]=M(e[A].rect[L]-a[L])+"px",s+=e[A].rect[N]-r[A].rect[N],e=r;e[A].animation&&e[A].animation.stop(),e[A].index++,e[A].rect.prev[L]=e[A].rect[L],e[A].rect[L]=t[A].rect.prev[L]+s,e.style[L]=M(e[A].rect[L]-a[L])+"px",(c={})[L]=l[A].rect[L]-l[A].rect.prev[L],U(l,o,c)}else if(0<n){for(i=t.nextElementSibling,g===t&&(g=i),e.nextElementSibling?v.insertBefore(t,e.nextElementSibling):(v.appendChild(t),x=t),t[A].index=e[A].index,e=i,s=0,(r=t)[A].rect.prev[L]=r[A].rect[L];e[A].animation&&e[A].animation.stop(),e[A].index--,e[A].rect.prev[L]=e[A].rect[L],e[A].rect[L]=r[A].rect.prev[L]+s,e.style[L]=M(e[A].rect[L]-a[L])+"px",s+=-(r[A].rect[N]-e[A].rect[N]),(e=(r=e).nextElementSibling)&&e!==t;);t[A].rect[L]=r[A].rect.prev[L]+s,(c={})[L]=l[A].rect[L]-l[A].rect.prev[L],U(l,o,c)}},z=j===u?J:H,B=(c=function(t){var e,n,o,r,i,c,l=0,s=window.scrollX,a=window.scrollY,p="left",f="width";X===u&&(p="top",f="height"),n=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientX,e=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientY,o=n-w,r=e-E,h[A].r=h.getBoundingClientRect(),i=s+h[A].r.left+h[A].r.width/2,c=a+h[A].r.top+h[A].r.height/2,t=h[A].r[p],a=G(n,e).concat(X===u?[]:G(s+h[A].r.left+2,c)).concat(X===u?[]:G(s+h[A].r.right-2,c)).concat(Y===u?[]:G(i,a+h[A].r.top+2)).concat(Y===u?[]:G(i,a+h[A].r.bottom-2)).reduce(function(t,e){var n;return e!==h&&e.parentNode===v&&(n=z(h,e,L,N),l<n&&(l=n,t=e)),t},null),r=j===u?(!a&&h!==g&&0<=g[A].rect[p]-(t+h[A].rect[f])&&g[A].rect[p]-(t+h[A].rect[f])<50&&.7<(l=H(h,g,"top","height"))&&(a=g),!a&&h!==x&&0<=t-(x[A].rect[p]+x[A].rect[f])&&t-(x[A].rect[p]+x[A].rect[f])<50&&.7<(l=H(h,x,"top","height"))&&(a=x),h.style.top=M(e-b)+"px",h.style.left=M(n-y)+"px",a?a[A].index-h[A].index:k.abs(r)>=k.abs(o)?r:o):(!a&&h!==g&&g[A].rect[p]>t+h[A].rect[f]&&(a=g),!a&&h!==x&&t>x[A].rect[p]+x[A].rect[f]&&(a=x),Y===u?(h.style[L]=M(n-y)+"px",o):(h.style[L]=M(e-b)+"px",r)),m&&(S<0&&0<r&&T<.5||0<S&&r<0&&T<.5||a&&m!==a&&T<l||!z(h,m,L,N))&&(F(m,d.opts.closestItem||"dnd-sortable-closest"),T=0,m=null),!m&&a&&l&&(m=a,S=0<r?1:-1,T=l,I=!1),w=n,E=e,m&&((l=l||z(h,m,L,N))?.3<=(T=l)?(D(m,d.opts.closestItem||"dnd-sortable-closest"),.5<l&&!I&&(I=!0,P(h,m,S,d.opts.animationMs||0))):F(m,d.opts.closestItem||"dnd-sortable-closest"):(F(m,d.opts.closestItem||"dnd-sortable-closest"),T=0,m=null))},s=!(l=60),function(){var t=arguments;s||(c.apply(this,t),s=!0,setTimeout(function(){s=!1},l))}),C=function(){a=v.getBoundingClientRect(),i=K(v,["width","height","box-sizing"]),(r=[].map.call(v.children,function(t,e){var n=t.getBoundingClientRect();return t[A]={index:e,rect:{top:n.top,left:n.left,width:n.width,height:n.height,prev:{}},r:null,style:K(t,["position","box-sizing","overflow","top","left","width","height","transform","transition"]),animation:null},t})).length&&(g=r[0],x=r[r.length-1]),D(v,d.opts.activeArea||"dnd-sortable-area"),v.style.boxSizing="border-box",v.style.width=M(a.width)+"px",v.style.height=M(a.height)+"px",h.draggable=!1,D(h,d.opts.activeItem||"dnd-sortable-dragged"),r.forEach(function(t){t.style.position="absolute",t.style.boxSizing="border-box",t.style.overflow="hidden",t.style.top=M(t[A].rect.top-a.top)+"px",t.style.left=M(t[A].rect.left-a.left)+"px",t.style.width=M(t[A].rect.width)+"px",t.style.height=M(t[A].rect.height)+"px"}),W(R,"touchmove",B,!1),W(R,"touchend",O,!1),W(R,"touchcancel",O,!1),W(R,"mousemove",B,!1),W(R,"mouseup",O,!1)},O=function(t){var e=h;o(),n(),"function"==typeof d.opts.onEnd&&d.opts.onEnd(e)};d.start=function(){f||(f=!0,n(),W(R,"touchstart",t,!0),W(R,"mousedown",t,!0))},d.stop=function(){f&&(q(R,"touchstart",t,!(f=!1)),q(R,"mousedown",t,!0),o(),n())}}function i(t,e){var n=this;if(!(n instanceof i))return new i(t,e);switch(n.opts=e||{},M(t||"vertical").toLowerCase()){case"unrestricted":r(n,j);break;case"horizontal":r(n,Y);break;default:r(n,X)}n.start()}return window.Element&&!o.call(window.Element.prototype,A)&&(window.Element.prototype[A]=null),i.VERSION="1.0.0",i.prototype={constructor:i,opts:null,start:null,stop:null,dispose:function(){var t=this;return t.stop&&t.stop(),t.opts=null,t.start=null,t.stop=null,t}},i});