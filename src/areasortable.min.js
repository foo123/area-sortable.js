/**
*  area-sortable.js
*  A simple js class to sort elements of an area using drag-and-drop (desktop and mobile)
*  @VERSION: 1.0.0
*
*  https://github.com/foo123/area-sortable.js
*
**/
!function(e,t,n){"use strict";var o;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(e.EXPORTED_SYMBOLS=[t],e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=o=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return o})}("undefined"!=typeof self?self:this,"AreaSortable",function(e){"use strict";var I="$dndSortable",o=1,N=2,R=o+N,s=Math,V=String,t=Object.prototype.hasOwnProperty,n=/^\s+|\s+$/g,l=V.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(n,"")};function O(e,t){return e.classList?e.classList.contains(t):-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function j(e,t){e.classList?e.classList.add(t):e.className=l(""===e.className?t:e.className+" "+t)}function q(e,t){e.classList?e.classList.remove(t):e.className=l((" "+e.className+" ").replace(" "+t+" "," "))}function A(e,t,n,o){e=e.getBoundingClientRect(),t=t.getBoundingClientRect();return s.max(0,s.min(1,s.max(0,s.min(e[n]+e[o],t[n]+t[o])-s.max(e[n],t[n]))/s.min(e[o],t[o])))}function D(e,t,n,o){var l=e.getBoundingClientRect(),i=t.getBoundingClientRect(),e=0,t=0,e=s.max(0,s.min(l.left+l.width,i.left+i.width)-s.max(l.left,i.left)),t=s.max(0,s.min(l.top+l.height,i.top+i.height)-s.max(l.top,i.top));return s.max(0,s.min(1,e*t/(s.min(l.width,i.width)*s.min(l.height,i.height))))}function i(s,r){function e(e){b||((n=e.target)&&O(n,s.opts.handle||"dnd-sortable-handle")&&(d=n.closest("."+(s.opts.item||"dnd-sortable-item")))&&(p=d.parentNode)&&p.id===s.opts.container?(e.preventDefault(),e.stopPropagation(),"function"==typeof s.opts.onStart&&s.opts.onStart(d),b=!0,c=null,u=p.getBoundingClientRect(),l={width:p.style.getPropertyValue("width"),height:p.style.getPropertyValue("height")},o=[].map.call(p.children,function(e,t){var n=e.getBoundingClientRect();return e[I]={index:t,rect:{top:n.top,left:n.left,width:n.width,height:n.height},style:{pos:e.style.getPropertyValue("position"),top:e.style.getPropertyValue("top"),left:e.style.getPropertyValue("left"),width:e.style.getPropertyValue("width"),height:e.style.getPropertyValue("height")}},e}),j(p,s.opts.activeArea||"dnd-sortable-area"),p.style.width=V(u.width)+"px",p.style.height=V(u.height)+"px",d.draggable=!1,j(d,s.opts.activeItem||"dnd-sortable-dragged"),o.forEach(function(e){e.style.position="absolute",e.style.top=V(e[I].rect.top-u.top)+"px",e.style.left=V(e[I].rect.left-u.left)+"px",e.style.width=V(e[I].rect.width)+"px",e.style.height=V(e[I].rect.height)+"px"}),h=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientX,m=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientY,a=h+u.left-d[I].rect.left,f=m+u.top-d[I].rect.top,R===r?(d.style.top=V(m-f)+"px",d.style.left=V(h-a)+"px"):d.style[L]=V(N===r?h-a:m-f)+"px",document.addEventListener("touchmove",C,!1),document.addEventListener("touchend",B,!1),document.addEventListener("touchcancel",B,!1),document.addEventListener("mousemove",C,!1),document.addEventListener("mouseup",B,!1)):T())}function t(){b&&(document.removeEventListener("touchmove",C,!1),document.removeEventListener("touchend",B,!1),document.removeEventListener("touchcancel",B,!1),document.removeEventListener("mousemove",C,!1),document.removeEventListener("mouseup",B,!1),""!==l.width?p.style.width=l.width:p.style.removeProperty("width"),""!==l.height?p.style.height=l.height:p.style.removeProperty("height"),q(p,s.opts.activeArea||"dnd-sortable-area"),c&&q(c,s.opts.closestItem||"dnd-sortable-closest"),q(d,s.opts.activeItem||"dnd-sortable-dragged"),o.forEach(function(e){""!==e[I].style.pos?e.style.position=e[I].style.pos:e.style.removeProperty("position"),""!==e[I].style.top?e.style.top=e[I].style.top:e.style.removeProperty("top"),""!==e[I].style.left?e.style.left=e[I].style.left:e.style.removeProperty("left"),""!==e[I].style.width?e.style.width=e[I].style.width:e.style.removeProperty("width"),""!==e[I].style.height?e.style.height=e[I].style.height:e.style.removeProperty("height"),e[I]=null}),b=!1)}var c,d,n,p,o,u,l,a,f,h,m,y,g,i,x,v,b=!1,E=!1,w=N===r?"width":"height",L=N===r?"left":"top",S=R===r?function(e,t,n){var o,l,i,s;if(n<0){for(s=e.nextElementSibling,i=e[I].rect.top,l=e[I].rect.left,p.insertBefore(e,t),e[I].index=t[I].index,e[I].rect.top=t[I].rect.top,e[I].rect.left=t[I].rect.left;(o=t.nextElementSibling)&&o!==s;)t[I].index++,t[I].rect.top=o[I].rect.top,t[I].rect.left=o[I].rect.left,t.style.top=V(t[I].rect.top-u.top)+"px",t.style.left=V(t[I].rect.left-u.left)+"px",t=o;t[I].index++,t[I].rect.top=i,t[I].rect.left=l,t.style.top=V(t[I].rect.top-u.top)+"px",t.style.left=V(t[I].rect.left-u.left)+"px"}else if(0<n){for(s=e.previousElementSibling,t.nextElementSibling?p.insertBefore(e,t.nextElementSibling):p.appendChild(e),e[I].index=t[I].index,t=s?s.nextElementSibling:t,o=e;t[I].index--,i=t[I].rect.top,l=t[I].rect.left,t[I].rect.top=o[I].rect.top,t[I].rect.left=o[I].rect.left,t.style.top=V(t[I].rect.top-u.top)+"px",t.style.left=V(t[I].rect.left-u.left)+"px",(t=(o=t).nextElementSibling)&&t!==e;);t[I].rect.top=i,t[I].rect.left=l,t.style.top=V(t[I].rect.top-u.top)+"px",t.style.left=V(t[I].rect.left-u.left)+"px"}}:function(e,t,n){var o,l,i,s=0;if(n<0){for(i=e.nextElementSibling,l=e[I].rect[L],p.insertBefore(e,t),e[I].index=t[I].index,e[I].rect[L]=t[I].rect[L],s=e[I].rect[w]-t[I].rect[w];(o=t.nextElementSibling)&&o!==i;)t[I].index++,t[I].rect[L]=o[I].rect[L]+s,t.style[L]=V(t[I].rect[L]-u[L])+"px",s=t[I].rect[w]-o[I].rect[w],t=o;t[I].index++,t[I].rect[L]=l+s,t.style[L]=V(t[I].rect[L]-u[L])+"px"}else if(0<n){for(i=e.previousElementSibling,t.nextElementSibling?p.insertBefore(e,t.nextElementSibling):p.appendChild(e),e[I].index=t[I].index,t=i?i.nextElementSibling:t,o=e,s=0;t[I].index--,l=t[I].rect[L],t[I].rect[L]=o[I].rect[L]+s,t.style[L]=V(t[I].rect[L]-u[L])+"px",s=t[I].rect[w]-o[I].rect[w],(t=(o=t).nextElementSibling)&&t!==e;);t[I].rect[L]=l+s,t.style[L]=V(t[I].rect[L]-u[L])+"px"}},P=R===r?D:A,C=(i=function(e){var t,o=0,n=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientX,l=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientY,i=n-h,e=l-m,e=R===r?(d.style.top=V(l-f)+"px",d.style.left=V(n-a)+"px",(t=document.elementsFromPoint(n,l).reduce(function(e,t){var n;return t!==d&&O(t,s.opts.item||"dnd-sortable-item")&&(n=P(d,t,L,w),o<n&&(o=n,e=t)),e},null))?t[I].index-d[I].index:y):N===r?(d.style[L]=V(n-a)+"px",i):(d.style[L]=V(l-f)+"px",e);c&&(y<0&&0<e||0<y&&e<0||!P(d,c,L,w))&&(q(c,s.opts.closestItem||"dnd-sortable-closest"),c=null),c||(R===r?t=t||document.elementsFromPoint(n,l).reduce(function(e,t){var n;return t!==d&&O(t,s.opts.item||"dnd-sortable-item")&&(n=P(d,t,L,w),o<n&&(o=n,e=t)),e},null):(t=document.elementsFromPoint(n,l).filter(function(e){return e!==d&&O(e,s.opts.item||"dnd-sortable-item")})[0])&&(o=P(d,t,L,w)),t&&o&&(c=t,y=0<e?1:-1,g=!1)),h=n,m=l,c&&((o=o||P(d,c,L,w))?.3<=o?(j(c,s.opts.closestItem||"dnd-sortable-closest"),.6<=o&&!g&&(g=!0,S(d,c,y))):q(c,s.opts.closestItem||"dnd-sortable-closest"):(q(c,s.opts.closestItem||"dnd-sortable-closest"),c=null))},v=!(x=20),function(){var e=arguments;v||(i.apply(this,e),v=!0,setTimeout(function(){v=!1},x))}),T=function(){l=u=o=p=d=n=c=null},B=function(e){t(),"function"==typeof s.opts.onEnd&&s.opts.onEnd(d),T()};s.start=function(){E||(E=!0,T(),document.addEventListener("touchstart",e,!0),document.addEventListener("mousedown",e,!0))},s.stop=function(){E&&(E=!1,document.removeEventListener("touchstart",e,!0),document.removeEventListener("mousedown",e,!0),t(),T())}}function r(e,t){var n=this;if(!(n instanceof r))return new r(e,t);switch(n.opts=t||{},V(e||"vertical").toLowerCase()){case"unrestricted":i(n,R);break;case"horizontal":i(n,N);break;default:i(n,o)}n.start()}return window.Element&&!t.call(window.Element.prototype,I)&&(window.Element.prototype[I]=null),r.VERSION="1.0.0",r.prototype={constructor:r,opts:null,start:null,stop:null,dispose:function(){var e=this;return e.stop&&e.stop(),e.opts=null,e.start=null,e.stop=null,e}},r});