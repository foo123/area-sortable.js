/**
*  area-sortable.js
*  A simple js class to sort elements of an area using drag-and-drop (desktop and mobile)
*  @VERSION: 1.0.0
*
*  https://github.com/foo123/area-sortable.js
*
**/
!function(t,e){"use strict";"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(function(t){return e()}):t.AreaSortable=e()}("undefined"!=typeof self?self:this,function(t){"use strict";var O=window.document,R="$dndSortable",A=1,F=2,k=A+F,D=Math,M=String,r=Object.prototype.hasOwnProperty,e=/^\s+|\s+$/g,V=/mousedown|pointerdown/,n=M.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(e,"")},o=function(){var e=!1,t={};try{Object.defineProperty(t,"passive",{get:function(){return!(e=!0)}}),window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(t){e=!1}return e}();function $(t,e){return t.classList?t.classList.contains(e):-1!==(" "+t.className+" ").indexOf(" "+e+" ")}function W(t,e){t.classList?t.classList.add(e):$(t,e)||(t.className=""===t.className?e:t.className+" "+e)}function q(t,e){t.classList?t.classList.remove(e):t.className=n((" "+t.className+" ").replace(" "+e+" "," "))}function G(t,e,n,r){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener(e,n,o?r:"object"==typeof r?!!r.capture:!!r)}function H(t,e,n,r){t.detachEvent?t.detachEvent("on"+e,n):t.removeEventListener(e,n,o?r:"object"==typeof r?!!r.capture:!!r)}function J(t,e){return O.elementsFromPoint(t,e)}function K(t,e,n,r){t=t[R].r,e=e[R].rect;return D.max(0,D.min(1,D.max(0,D.min(t[n]+t[r],e[n]+e[r])-D.max(t[n],e[n]))/D.min(t[r],e[r])))}function Q(t,e,n,r){var o=t[R].r,i=e[R].rect,t=0,e=0,t=D.max(0,D.min(o.left+o.width,i.left+i.width)-D.max(o.left,i.left)),e=D.max(0,D.min(o.top+o.height,i.top+i.height)-D.max(o.top,i.top));return D.max(0,D.min(1,t*e/(D.min(o.width,i.width)*D.min(o.height,i.height))))}function U(n,t){return t.reduce(function(t,e){return t[e]=n.style.getPropertyValue(e),t},{})}function Z(e,t,n){n=n||e[R].style,t.forEach(function(t){r.call(n,t)&&""!==n[t]?e.style[t]=n[t]:e.style.removeProperty(t)})}function _(e,t,n){var r,o,i,c;return 0<t&&(e[R].animation&&e[R].animation.stop(),r="transform "+M(t)+"ms",o="translate3d(0,0,0)",i=null,c=function t(){return i&&clearTimeout(i),i=null,e[R]&&e[R].animation&&t===e[R].animation.stop&&(e[R].animation=null),e.style.transform===o&&e.style.transition===r&&(e.style.transition="none",e.style.transform="none"),e},e.style.transition="none",e.style.transform="translate3d("+M(-(n.left||0))+"px,"+M(-(n.top||0))+"px,0)",e.offsetWidth,e.style.transform=o,e.style.transition=r,i=setTimeout(c,t),e[R].animation={stop:c}),e}function i(p,f){function n(){i=v=o=h=g=d=u=e=m=null,I=!1,T=0}function t(t){!s&&p.opts.container&&(V.test(t.type)&&0!==t.button||(n(),!(e=t.target)||!$(e,p.opts.handle||"dnd-sortable-handle")||!(m=function(t,e){if(t.closest)return t.closest("."+e);for(;t;){if($(t,e))return t;t=t.parentNode}}(e,p.opts.item||"dnd-sortable-item"))||!(h=m.parentNode)||"string"==typeof p.opts.container&&h.id!==p.opts.container||"string"!=typeof p.opts.container&&h!==p.opts.container?n():("function"==typeof p.opts.onStart&&p.opts.onStart(m),"function"!=typeof p.opts.itemFilter||(m=p.opts.itemFilter(m))?(s=!0,t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),Y(),E={X:0,Y:0},b=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientX,w=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientY,x=b+v.left-m[R].rect.left+m[R].margin.left,y=w+v.top-m[R].rect.top+m[R].margin.top,k===f?(m.style.top=M(w-y)+"px",m.style.left=M(b-x)+"px"):m.style[P]=M(F===f?b-x:w-y)+"px"):n())))}function r(){s&&(H(O,"touchmove",X,!1),H(O,"touchend",j,!1),H(O,"touchcancel",j,!1),H(O,"mousemove",X,!1),H(O,"mouseup",j,!1),q(h,p.opts.activeArea||"dnd-sortable-area"),Z(h,["width","height","box-sizing"],i),u&&q(u,p.opts.closestItem||"dnd-sortable-closest"),q(m,p.opts.activeItem||"dnd-sortable-dragged"),o.forEach(function(t){Z(t,["position","box-sizing","overflow","margin","margin-top","margin-left","margin-right","margin-bottom","top","left","width","height","transform","transition"]),t[R]=null}),s=!1)}var m,e,u,d,g,h,o,v,i,x,y,b,w,E,S,T,I,c,a,l,s=!1,L=!1,N=F===f?"width":"height",P=F===f?"left":"top",z="left"==P?"right":"bottom",B=k===f?function(t,e,n,r){var o,i,c=e;if(d!==g)if(n<0){for(i=t.nextElementSibling,d===e&&(d=t),g===t&&(g=t.previousElementSibling),h.insertBefore(t,e),t[R].index=e[R].index,t[R].rect.prev.top=t[R].rect.top,t[R].rect.prev.left=t[R].rect.left,t[R].rect.top=e[R].rect.top,t[R].rect.left=e[R].rect.left;(o=e.nextElementSibling)&&o!==i;)e[R].animation&&e[R].animation.stop(),e[R].index++,e[R].rect.prev.top=e[R].rect.top,e[R].rect.prev.left=e[R].rect.left,e[R].rect.top=o[R].rect.top,e[R].rect.left=o[R].rect.left,e.style.top=M(e[R].rect.top-v.top-e[R].margin.top)+"px",e.style.left=M(e[R].rect.left-v.left-e[R].margin.left)+"px",e=o;e[R].animation&&e[R].animation.stop(),e[R].index++,e[R].rect.prev.top=e[R].rect.top,e[R].rect.prev.left=e[R].rect.left,e[R].rect.top=t[R].rect.prev.top,e[R].rect.left=t[R].rect.prev.left,e.style.top=M(e[R].rect.top-v.top-e[R].margin.top)+"px",e.style.left=M(e[R].rect.left-v.left-e[R].margin.left)+"px",_(c,r,{top:c[R].rect.top-c[R].rect.prev.top,left:c[R].rect.left-c[R].rect.prev.left})}else if(0<n){for(i=t.nextElementSibling,d===t&&(d=i),e.nextElementSibling?h.insertBefore(t,e.nextElementSibling):(h.appendChild(t),g=t),t[R].index=e[R].index,e=i,(o=t)[R].rect.prev.top=o[R].rect.top,o[R].rect.prev.left=o[R].rect.left;e[R].animation&&e[R].animation.stop(),e[R].index--,e[R].rect.prev.top=e[R].rect.top,e[R].rect.prev.left=e[R].rect.left,e[R].rect.top=o[R].rect.prev.top,e[R].rect.left=o[R].rect.prev.left,e.style.top=M(e[R].rect.top-v.top-e[R].margin.top)+"px",e.style.left=M(e[R].rect.left-v.left-e[R].margin.left)+"px",(e=(o=e).nextElementSibling)&&e!==t;);t[R].rect.top=o[R].rect.prev.top,t[R].rect.left=o[R].rect.prev.left,_(c,r,{top:c[R].rect.top-c[R].rect.prev.top,left:c[R].rect.left-c[R].rect.prev.left})}}:function(t,e,n,r){var o,i,c,a=e,l=0,s=0;if(d!==g)if(n<0){for(i=t.nextElementSibling,d===e&&(d=t),g===t&&(g=t.previousElementSibling),h.insertBefore(t,e),t[R].index=e[R].index,t[R].rect.prev[P]=t[R].rect[P],s=t[R].margin[P]-e[R].margin[P],t[R].rect[P]=e[R].rect[P]+s,l=t[R].rect[N]-e[R].rect[N],s+=t[R].margin[z]-e[R].margin[z];(o=e.nextElementSibling)&&o!==i;)e[R].animation&&e[R].animation.stop(),e[R].index++,e[R].rect.prev[P]=e[R].rect[P],s+=e[R].margin[P]-o[R].margin[P],e[R].rect[P]=o[R].rect[P]+l+s,s+=e[R].margin[z]-o[R].margin[z],e.style[P]=M(e[R].rect[P]-v[P]-e[R].margin[P])+"px",l+=e[R].rect[N]-o[R].rect[N],e=o;e[R].animation&&e[R].animation.stop(),e[R].index++,e[R].rect.prev[P]=e[R].rect[P],e[R].rect[P]=t[R].rect.prev[P]+l+s-t[R].margin[P]+e[R].margin[P],e.style[P]=M(e[R].rect[P]-v[P]-e[R].margin[P])+"px",(c={})[P]=a[R].rect[P]-a[R].rect.prev[P],_(a,r,c)}else if(0<n){for(i=t.nextElementSibling,d===t&&(d=i),e.nextElementSibling?h.insertBefore(t,e.nextElementSibling):(h.appendChild(t),g=t),t[R].index=e[R].index,e=i,l=s=0,(o=t)[R].rect.prev[P]=o[R].rect[P];e[R].animation&&e[R].animation.stop(),e[R].index--,e[R].rect.prev[P]=e[R].rect[P],s+=e[R].margin[P]-o[R].margin[P],e[R].rect[P]=o[R].rect.prev[P]+l+s,e.style[P]=M(e[R].rect[P]-v[P]-e[R].margin[P])+"px",l+=-(o[R].rect[N]-e[R].rect[N]),s+=e[R].margin[z]-o[R].margin[z],(e=(o=e).nextElementSibling)&&e!==t;);t[R].rect[P]=o[R].rect.prev[P]+l+s-o[R].margin[P]+t[R].margin[P],(c={})[P]=a[R].rect[P]-a[R].rect.prev[P],_(a,r,c)}},C=k===f?Q:K,X=(c=function(t){var e,n,r,o,i,c,a=0,l="left",s="width";A===f&&(l="top",s="height"),n=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientX,e=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientY,r=n-b,o=e-w,m[R].r.top=e-y+v.top+m[R].margin.top,m[R].r.left=n-x+v.left+m[R].margin.left,i=E.X+m[R].r.left+m[R].r.width/2,c=E.Y+m[R].r.top+m[R].r.height/2,t=m[R].r[l],i=J(n,e).concat(A===f?[]:J(E.X+m[R].r.left+2,c)).concat(A===f?[]:J(E.X+m[R].r.left+m[R].r.width-2,c)).concat(F===f?[]:J(i,E.Y+m[R].r.top+2)).concat(F===f?[]:J(i,E.Y+m[R].r.top+m[R].r.height-2)).reduce(function(t,e){var n;return e!==m&&e.parentNode===h&&(n=C(m,e,P,N),a<n&&(a=n,t=e)),t},null),o=k===f?(!i&&m!==d&&0<=d[R].rect[l]-(t+m[R].rect[s])&&d[R].rect[l]-(t+m[R].rect[s])<50&&.7<(a=K(m,d,"top","height"))&&(i=d),!i&&m!==g&&0<=t-(g[R].rect[l]+g[R].rect[s])&&t-(g[R].rect[l]+g[R].rect[s])<50&&.7<(a=K(m,g,"top","height"))&&(i=g),m.style.top=M(e-y)+"px",m.style.left=M(n-x)+"px",i?i[R].index-m[R].index:D.abs(o)>=D.abs(r)?o:r):(!i&&m!==d&&d[R].rect[l]>t+m[R].rect[s]&&(i=d),!i&&m!==g&&t>g[R].rect[l]+g[R].rect[s]&&(i=g),F===f?(m.style[P]=M(n-x)+"px",r):(m.style[P]=M(e-y)+"px",o)),u&&(S<0&&0<o&&T<.5||0<S&&o<0&&T<.5||i&&u!==i&&T<a||!C(m,u,P,N))&&(q(u,p.opts.closestItem||"dnd-sortable-closest"),T=0,u=null),!u&&i&&a&&(u=i,S=0<o?1:-1,T=a,I=!1),b=n,w=e,u&&((a=a||C(m,u,P,N))?.2<(T=a)?(W(u,p.opts.closestItem||"dnd-sortable-closest"),.5<a&&!I&&(I=!0,B(m,u,S,p.opts.animationMs||0))):q(u,p.opts.closestItem||"dnd-sortable-closest"):(q(u,p.opts.closestItem||"dnd-sortable-closest"),T=0,u=null))},l=!(a=60),function(){var t=arguments;l||(c.apply(this,t),l=!0,setTimeout(function(){l=!1},a))}),Y=function(){v=h.getBoundingClientRect(),i=U(h,["width","height","box-sizing"]),(o=[].map.call(h.children,function(t,e){var n,r=t.getBoundingClientRect(),n=(n=t,"function"==typeof window.getComputedStyle?window.getComputedStyle(n):n.currentStyle);return t[R]={index:e,rect:{top:r.top,left:r.left,width:r.width,height:r.height,prev:{}},r:{top:r.top,left:r.left,width:r.width,height:r.height},margin:{top:parseInt(n.marginTop)||0,right:parseInt(n.marginRight)||0,bottom:parseInt(n.marginBottom)||0,left:parseInt(n.marginLeft)||0},style:U(t,["position","box-sizing","overflow","margin","margin-top","margin-left","margin-right","margin-bottom","top","left","width","height","transform","transition"]),animation:null},t})).length&&(d=o[0],g=o[o.length-1]),W(h,p.opts.activeArea||"dnd-sortable-area"),h.style.boxSizing="border-box",h.style.width=M(v.width)+"px",h.style.height=M(v.height)+"px",m.draggable=!1,W(m,p.opts.activeItem||"dnd-sortable-dragged"),o.forEach(function(t){t.style.position="absolute",t.style.boxSizing="border-box",t.style.overflow="hidden",t.style.top=M(t[R].rect.top-v.top-t[R].margin.top)+"px",t.style.left=M(t[R].rect.left-v.left-t[R].margin.left)+"px",t.style.width=M(t[R].rect.width)+"px",t.style.height=M(t[R].rect.height)+"px"}),G(O,"touchmove",X,!1),G(O,"touchend",j,!1),G(O,"touchcancel",j,!1),G(O,"mousemove",X,!1),G(O,"mouseup",j,!1)},j=function(t){var e=m;r(),n(),"function"==typeof p.opts.onEnd&&p.opts.onEnd(e)};p.start=function(){L||(L=!0,n(),G(O,"touchstart",t,{capture:!0,passive:!1}),G(O,"mousedown",t,{capture:!0,passive:!1}))},p.stop=function(){L&&(H(O,"touchstart",t,{capture:!(L=!1),passive:!1}),H(O,"mousedown",t,{capture:!0,passive:!1}),r(),n())}}function c(t,e){var n=this;if(!(n instanceof c))return new c(t,e);switch(n.opts=e||{},M(t||"vertical").toLowerCase()){case"unrestricted":i(n,k);break;case"horizontal":i(n,F);break;default:i(n,A)}n.start()}return window.Element&&!r.call(window.Element.prototype,R)&&(window.Element.prototype[R]=null),c.VERSION="1.0.0",c.prototype={constructor:c,opts:null,start:null,stop:null,dispose:function(){var t=this;return t.stop&&t.stop(),t.opts=null,t.start=null,t.stop=null,t}},c});