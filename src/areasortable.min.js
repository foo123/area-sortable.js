/**
*  area-sortable.js
*  A simple js class to sort elements of an area using drag-and-drop (desktop and mobile)
*  @VERSION: 1.0.0
*
*  https://github.com/foo123/area-sortable.js
*
**/
!function(t,e,n){"use strict";var o;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(t.EXPORTED_SYMBOLS=[e],t[e]=n.call(t)):"object"==typeof module&&module.exports?module.exports=n.call(t):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["require","exports","module"],function(){return n.call(t)}):e in t||(t[e]=o=n.call(t))&&"function"==typeof define&&define.amd&&define(function(){return o})}("undefined"!=typeof self?self:this,"AreaSortable",function(t){"use strict";var O="$dndSortable",j=1,q=2,A=j+q,D=Math,M=String,o=Object.prototype.hasOwnProperty,e=/^\s+|\s+$/g,n=M.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(e,"")};"undefined"!=typeof Promise&&Promise.resolve().then.bind(Promise.resolve());function X(t,e){return t.classList?t.classList.contains(e):-1!==(" "+t.className+" ").indexOf(" "+e+" ")}function Y(t,e){t.classList?t.classList.add(e):X(t,e)||(t.className=""===t.className?e:t.className+" "+e)}function k(t,e){t.classList?t.classList.remove(e):t.className=n((" "+t.className+" ").replace(" "+e+" "," "))}function V(t,e,n,o){t=t.getBoundingClientRect(),e=e.getBoundingClientRect();return D.max(0,D.min(1,D.max(0,D.min(t[n]+t[o],e[n]+e[o])-D.max(t[n],e[n]))/D.min(t[o],e[o])))}function $(t,e,n,o){var r=t.getBoundingClientRect(),i=e.getBoundingClientRect(),t=0,e=0,t=D.max(0,D.min(r.left+r.width,i.left+i.width)-D.max(r.left,i.left)),e=D.max(0,D.min(r.top+r.height,i.top+i.height)-D.max(r.top,i.top));return D.max(0,D.min(1,t*e/(D.min(r.width,i.width)*D.min(r.height,i.height))))}function z(n,t){return t.reduce(function(t,e){return t[e]=n.style.getPropertyValue(e),t},{})}function F(e,t,n){n=n||e[O].style,t.forEach(function(t){o.call(n,t)&&""!==n[t]?e.style[t]=n[t]:e.style.removeProperty(t)})}function W(t,e,n){var o,r,i;0<e&&(t.style.transition="none",t.style.transform="translate3d("+M(-(n.left||0))+"px,"+M(-(n.top||0))+"px,0)",t.offsetWidth,o="all "+M(e)+"ms",r="translate3d(0,0,0)",t.style.transform=r,t.style.transition=o,n=function(){return i&&clearTimeout(i),i=null,t.style.transition===o&&(t.style.transition="none"),t.style.transform===r&&(t.style.transform="none"),t[O].animation=null,t},i=setTimeout(n,e),t[O].animation={stop:n})}function r(p,a){function n(){i=v=r=h=m=u=f=e=d=null,L=!1,w=0}function t(t){S||/mousedown|pointerdown/.test(t.type)&&0!==t.button||(n(),(e=t.target)&&X(e,p.opts.handle||"dnd-sortable-handle")&&(d=e.closest("."+(p.opts.item||"dnd-sortable-item")))&&(h=d.parentNode)&&h.id===p.opts.container?(S=!0,t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),v=h.getBoundingClientRect(),i=z(h,["width","height"]),(r=[].map.call(h.children,function(t,e){var n=t.getBoundingClientRect();return t[O]={index:e,rect:{top:n.top,left:n.left,width:n.width,height:n.height,prev:{}},style:z(t,["position","top","left","width","height","transform","transition"])},t})).length&&(u=r[0],m=r[r.length-1]),Y(h,p.opts.activeArea||"dnd-sortable-area"),h.style.width=M(v.width)+"px",h.style.height=M(v.height)+"px",d.draggable=!1,Y(d,p.opts.activeItem||"dnd-sortable-dragged"),r.forEach(function(t){t.style.position="absolute",t.style.top=M(t[O].rect.top-v.top)+"px",t.style.left=M(t[O].rect.left-v.left)+"px",t.style.width=M(t[O].rect.width)+"px",t.style.height=M(t[O].rect.height)+"px"}),"function"==typeof p.opts.onStart&&p.opts.onStart(d),y=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientX,b=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientY,g=y+v.left-d[O].rect.left,x=b+v.top-d[O].rect.top,A===a?(d.style.top=M(b-x)+"px",d.style.left=M(y-g)+"px"):d.style[B]=M(q===a?y-g:b-x)+"px",document.addEventListener("touchmove",N,!1),document.addEventListener("touchend",R,!1),document.addEventListener("touchcancel",R,!1),document.addEventListener("mousemove",N,!1),document.addEventListener("mouseup",R,!1)):n())}function o(){S&&(document.removeEventListener("touchmove",N,!1),document.removeEventListener("touchend",R,!1),document.removeEventListener("touchcancel",R,!1),document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",R,!1),k(h,p.opts.activeArea||"dnd-sortable-area"),F(h,["width","height"],i),f&&k(f,p.opts.closestItem||"dnd-sortable-closest"),k(d,p.opts.activeItem||"dnd-sortable-dragged"),r.forEach(function(t){F(t,["position","top","left","width","height","transform","transition"]),t[O]=null}),S=!1)}var d,e,f,u,m,h,r,v,i,g,x,y,b,E,w,L,c,s,l,S=!1,T=!1,C=q===a?"width":"height",B=q===a?"left":"top",P=A===a?function(t,e,n,o){var r,i,c=e;if(u!==m)if(n<0){for(i=t.nextElementSibling,u===e&&(u=t),m===t&&(m=t.previousElementSibling),h.insertBefore(t,e),t[O].index=e[O].index,t[O].rect.prev.top=t[O].rect.top,t[O].rect.prev.left=t[O].rect.left,t[O].rect.top=e[O].rect.top,t[O].rect.left=e[O].rect.left;(r=e.nextElementSibling)&&r!==i;)e[O].animation&&e[O].animation.stop(),e[O].index++,e[O].rect.prev.top=e[O].rect.top,e[O].rect.prev.left=e[O].rect.left,e[O].rect.top=r[O].rect.top,e[O].rect.left=r[O].rect.left,e.style.top=M(e[O].rect.top-v.top)+"px",e.style.left=M(e[O].rect.left-v.left)+"px",e=r;e[O].animation&&e[O].animation.stop(),e[O].index++,e[O].rect.prev.top=e[O].rect.top,e[O].rect.prev.left=e[O].rect.left,e[O].rect.top=t[O].rect.prev.top,e[O].rect.left=t[O].rect.prev.left,e.style.top=M(e[O].rect.top-v.top)+"px",e.style.left=M(e[O].rect.left-v.left)+"px",W(c,o,{top:c[O].rect.top-c[O].rect.prev.top,left:c[O].rect.left-c[O].rect.prev.left})}else if(0<n){for(i=t.nextElementSibling,u===t&&(u=i),e.nextElementSibling?h.insertBefore(t,e.nextElementSibling):(h.appendChild(t),m=t),t[O].index=e[O].index,e=i,(r=t)[O].rect.prev.top=r[O].rect.top,r[O].rect.prev.left=r[O].rect.left;e[O].animation&&e[O].animation.stop(),e[O].index--,e[O].rect.prev.top=e[O].rect.top,e[O].rect.prev.left=e[O].rect.left,e[O].rect.top=r[O].rect.prev.top,e[O].rect.left=r[O].rect.prev.left,e.style.top=M(e[O].rect.top-v.top)+"px",e.style.left=M(e[O].rect.left-v.left)+"px",(e=(r=e).nextElementSibling)&&e!==t;);t[O].rect.top=r[O].rect.prev.top,t[O].rect.left=r[O].rect.prev.left,W(c,o,{top:c[O].rect.top-c[O].rect.prev.top,left:c[O].rect.left-c[O].rect.prev.left})}}:function(t,e,n,o){var r,i,c,s=e,l=0;if(u!==m)if(n<0){for(i=t.nextElementSibling,u===e&&(u=t),m===t&&(m=t.previousElementSibling),h.insertBefore(t,e),t[O].index=e[O].index,t[O].rect.prev[B]=t[O].rect[B],t[O].rect[B]=e[O].rect[B],l=t[O].rect[C]-e[O].rect[C];(r=e.nextElementSibling)&&r!==i;)e[O].animation&&e[O].animation.stop(),e[O].index++,e[O].rect.prev[B]=e[O].rect[B],e[O].rect[B]=r[O].rect[B]+l,e.style[B]=M(e[O].rect[B]-v[B])+"px",l+=e[O].rect[C]-r[O].rect[C],e=r;e[O].animation&&e[O].animation.stop(),e[O].index++,e[O].rect.prev[B]=e[O].rect[B],e[O].rect[B]=t[O].rect.prev[B]+l,e.style[B]=M(e[O].rect[B]-v[B])+"px",(c={})[B]=s[O].rect[B]-s[O].rect.prev[B],W(s,o,c)}else if(0<n){for(i=t.nextElementSibling,u===t&&(u=i),e.nextElementSibling?h.insertBefore(t,e.nextElementSibling):(h.appendChild(t),m=t),t[O].index=e[O].index,e=i,l=0,(r=t)[O].rect.prev[B]=r[O].rect[B];e[O].animation&&e[O].animation.stop(),e[O].index--,e[O].rect.prev[B]=e[O].rect[B],e[O].rect[B]=r[O].rect.prev[B]+l,e.style[B]=M(e[O].rect[B]-v[B])+"px",l+=-(r[O].rect[C]-e[O].rect[C]),(e=(r=e).nextElementSibling)&&e!==t;);t[O].rect[B]=r[O].rect.prev[B]+l,(c={})[B]=s[O].rect[B]-s[O].rect.prev[B],W(s,o,c)}},I=A===a?$:V,N=(c=function(t){var e,n,o,r,i,c=0,s="left",l="width";j===a&&(s="top",l="height"),n=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientX,e=(t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t).clientY,o=n-y,r=e-b,(t=document.elementsFromPoint(n,e).reduce(function(t,e){var n;return e!==d&&e.parentNode===h&&(n=I(d,e,B,C),c<n&&(c=n,t=e)),t},null))||(i=d.getBoundingClientRect()[s]),r=A===a?(!t&&d!==u&&0<=u[O].rect[s]-(i+d[O].rect[l])&&u[O].rect[s]-(i+d[O].rect[l])<50&&.7<(c=V(d,u,"top","height"))&&(t=u),!t&&d!==m&&0<=i-(m[O].rect[s]+m[O].rect[l])&&i-(m[O].rect[s]+m[O].rect[l])<50&&.7<(c=V(d,m,"top","height"))&&(t=m),d.style.top=M(e-x)+"px",d.style.left=M(n-g)+"px",t?t[O].index-d[O].index:D.abs(r)>=D.abs(o)?r:o):(!t&&d!==u&&u[O].rect[s]>i+d[O].rect[l]&&(t=u),!t&&d!==m&&i>m[O].rect[s]+m[O].rect[l]&&(t=m),q===a?(d.style[B]=M(n-g)+"px",o):(d.style[B]=M(e-x)+"px",r)),f&&(E<0&&0<r&&w<.5||0<E&&r<0&&w<.5||t&&f!==t&&w<c||!I(d,f,B,C))&&(k(f,p.opts.closestItem||"dnd-sortable-closest"),w=0,f=null),!f&&t&&c&&(f=t,E=0<r?1:-1,w=c,L=!1),y=n,b=e,f&&((c=c||I(d,f,B,C))?.3<=(w=c)?(Y(f,p.opts.closestItem||"dnd-sortable-closest"),.5<c&&!L&&(L=!0,P(d,f,E,p.opts.animationMs))):k(f,p.opts.closestItem||"dnd-sortable-closest"):(k(f,p.opts.closestItem||"dnd-sortable-closest"),w=0,f=null))},l=!(s=60),function(){var t=arguments;l||(c.apply(this,t),l=!0,setTimeout(function(){l=!1},s))}),R=function(t){var e=d;o(),n(),"function"==typeof p.opts.onEnd&&p.opts.onEnd(e)};p.start=function(){T||(T=!0,n(),document.addEventListener("touchstart",t,!0),document.addEventListener("mousedown",t,!0))},p.stop=function(){T&&(T=!1,document.removeEventListener("touchstart",t,!0),document.removeEventListener("mousedown",t,!0),o(),n())}}function i(t,e){var n=this;if(!(n instanceof i))return new i(t,e);switch(n.opts=e||{},M(t||"vertical").toLowerCase()){case"unrestricted":r(n,A);break;case"horizontal":r(n,q);break;default:r(n,j)}n.start()}return window.Element&&!o.call(window.Element.prototype,O)&&(window.Element.prototype[O]=null),i.VERSION="1.0.0",i.prototype={constructor:i,opts:null,start:null,stop:null,dispose:function(){var t=this;return t.stop&&t.stop(),t.opts=null,t.start=null,t.stop=null,t}},i});