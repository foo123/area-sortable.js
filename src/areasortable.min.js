/**
*  area-sortable.js
*  A simple js class to sort elements of an area using drag-and-drop (desktop and mobile)
*  @VERSION: 1.1.0
*
*  https://github.com/foo123/area-sortable.js
*
**/
!function(e,t){"use strict";"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(function(e){return t()}):e.AreaSortable=t()}("undefined"!=typeof self?self:this,function(e){"use strict";var Y=window.document,D="$dndSortable",M="rect",V="style",W="margin",q="padding",G="left",H="right",J="width",K="top",Q="bottom",U="height",Z="nextElementSibling",_="previousElementSibling",ee=1,te=2,ne=ee+te,oe=Math,ie=String,re=parseInt,o=Object.prototype.hasOwnProperty,t=/^\s+|\s+$/g,ae=/mousedown|pointerdown/,n=ie.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(t,"")},i=function(){var t=!1,e={};try{Object.defineProperty(e,"passive",{get:function(){return!(t=!0)}}),window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){t=!1}return t}();function se(e,t){return e.classList?e.classList.contains(t):-1!==(" "+e.className+" ").indexOf(" "+t+" ")}function pe(e,t){e.classList?e.classList.add(t):se(e,t)||(e.className=""===e.className?t:e.className+" "+t)}function le(e,t){e.classList?e.classList.remove(t):e.className=n((" "+e.className+" ").replace(" "+t+" "," "))}function ce(e,t,n,o){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,i?o:"object"==typeof o?!!o.capture:!!o)}function p(e,t,n,o){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,i?o:"object"==typeof o?!!o.capture:!!o)}function de(e){return("function"==typeof window.getComputedStyle?window.getComputedStyle(e):e.currentStyle)||{}}function ue(e,t){return Y.elementsFromPoint(e,t)}function fe(n,e){return e.reduce(function(e,t){return e[t]=n[V].getPropertyValue(t),e},{})}function me(t,e,n){n=n||t[D][V],e.forEach(function(e){o.call(n,e)&&""!==n[e]?t[V][e]=n[e]:t[V].removeProperty(e)})}function ve(t,e,n){var o,i,r,a;return 0<e&&(t[D].animation&&t[D].animation.stop(),o="transform "+ie(e)+"ms",i="translate3d(0,0,0)",r=null,a=function e(){return r&&clearTimeout(r),r=null,t[D]&&t[D].animation&&e===t[D].animation.stop&&(t[D].animation=null),t[V].transform===i&&t[V].transition===o&&(t[V].transition="none",t[V].transform="none"),t},t[V].transition="none",t[V].transform="translate3d("+ie(-(n[G]||0))+"px,"+ie(-(n[K]||0))+"px,0)",t.offsetWidth,t[V].transform=i,t[V].transition=o,r=setTimeout(a,e),t[D].animation={stop:a}),t}function he(e,t,n,o){e=e[D].r,t=t[D][M];return oe.max(0,oe.min(1,oe.max(0,oe.min(e[n]+e[o],t[n]+t[o])-oe.max(e[n],t[n]))/oe.min(e[o],t[o])))}function xe(e,t,n,o){var i=e[D].r,r=t[D][M],e=0,t=0,e=oe.max(0,oe.min(i[G]+i[J],r[G]+r[J])-oe.max(i[G],r[G])),t=oe.max(0,oe.min(i[K]+i[U],r[K]+r[U])-oe.max(i[K],r[K]));return oe.max(0,oe.min(1,e*t/(oe.min(i[J],r[J])*oe.min(i[U],r[U]))))}function r(u,f){function n(){d=c=w=y=b=g=x=h=v=t=m=l=null,C=!1,I=0}function o(){P&&(z?(p(Y,"touchmove",F,!1),p(Y,"touchend",X,!1),p(Y,"touchcancel",X,!1)):(p(Y,"mousemove",F,!1),p(Y,"mouseup",X,!1)),l&&l.parentNode&&l.parentNode.removeChild(l),le(g,u.opts.activeArea||"dnd-sortable-area"),me(g,["width","height","box-sizing"],y),v&&le(v,u.opts.closestItem||"dnd-sortable-closest"),le(m,u.opts.activeItem||"dnd-sortable-dragged"),c.forEach(function(e){me(e,["position","box-sizing","overflow","top","left","width","height","transform","transition"]),e[D]=null}),P=!1)}function e(e){var i,r,a,s,p;B&&!P&&u.opts.container&&(ae.test(e.type)&&0!==e.button||(n(),!(t=e.target)||!se(t,u.opts.handle||"dnd-sortable-handle")||!(m=function(e,t){if(e.closest)return e.closest("."+t);for(;e;){if(se(e,t))return e;e=e.parentNode}}(t,u.opts.item||"dnd-sortable-item"))||!(g=m.parentNode)||"string"==typeof u.opts.container&&g.id!==u.opts.container||"string"!=typeof u.opts.container&&g!==u.opts.container?n():("function"==typeof u.opts.onStart&&u.opts.onStart(m),"function"!=typeof u.opts.itemFilter||(m=u.opts.itemFilter(m))?(P=!0,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),z=e.changedTouches&&e.changedTouches.length,r=i=0,a=G,s=J,p=H,y=fe(g,["width","height","box-sizing"]),w=de(g),(b=g.getBoundingClientRect())[q]={left:re(w.paddingLeft)||0,right:re(w.paddingRight)||0},(c=[].map.call(g.children,function(e,t){var n=e.getBoundingClientRect(),o=de(e);return e[D]={index:t,line:0,prev:{},rect:{top:n[K],left:n[G],width:n[J],height:n[U]},r:{top:n[K],left:n[G],width:n[J],height:n[U]},margin:{top:re(o.marginTop)||0,right:re(o.marginRight)||0,bottom:re(o.marginBottom)||0,left:re(o.marginLeft)||0},$:o,style:fe(e,["position","box-sizing","overflow","top","left","width","height","transform","transition"]),animation:null},o=e[D][W][a]+e[D][M][s]+e[D][W][p],0<r&&b[q][a]+r+o+b[q][p]>b[s]&&(i++,r=0),e[D].line=i,r+=o,e})).length&&(h=c[0],x=c[c.length-1]),a=K,s=U,p=Q,d=new Array(c.length),c.forEach(function(e){var t=e[D].line,e=e[D][M][a]-e[D][W][a]-b[a];d[t]=null==d[t]?e:oe.min(e,d[t])}),pe(g,u.opts.activeArea||"dnd-sortable-area"),g[V].boxSizing="border-box",g[V][J]=ie(b[J])+"px",g[V][U]=ie(b[U])+"px",m.draggable=!1,pe(m,u.opts.activeItem||"dnd-sortable-dragged"),O=!0,c.forEach(function(e){var t=c[0];e[V].position="absolute",e[V].boxSizing="border-box",e[V].overflow="hidden",e[V][K]=ie(e[D][M][K]-b[K]-e[D][W][K])+"px",e[V][G]=ie(e[D][M][G]-b[G]-e[D][W][G])+"px",e[V][J]=ie(e[D][M][J])+"px",e[V][U]=ie(e[D][M][U])+"px",e[D][M][J]===t[D][M][J]&&e[D][M][U]===t[D][M][U]&&e[D][W][K]===t[D][W][K]&&e[D][W][Q]===t[D][W][Q]&&e[D][W][G]===t[D][W][G]&&e[D][W][H]===t[D][W][H]||(O=!1)}),l=Y.createElement("div"),Y.body.appendChild(l),pe(l,u.opts.placeholder||"dnd-sortable-placeholder"),l[V].position="absolute",l[V].display="block",l[V].boxSizing="border-box",l[V].margin="0",z?(ce(Y,"touchmove",F,!1),ce(Y,"touchend",X,!1),ce(Y,"touchcancel",X,!1)):(ce(Y,"mousemove",F,!1),ce(Y,"mouseup",X,!1)),T=(z?e.changedTouches[0]:e).clientX,L=(z?e.changedTouches[0]:e).clientY,S=T+b[G]-m[D][M][G]+m[D][W][G],E=L+b[K]-m[D][M][K]+m[D][W][K],ne===f?(m[V][K]=ie(L-E)+"px",m[V][G]=ie(T-S)+"px"):m[V][j]=ie(te===f?T-S:L-E)+"px",l[D]={S:{top:window.pageYOffset||0,left:window.pageXOffset||0}},l[V][J]=ie(m[D][M][J])+"px",l[V][U]=ie(m[D][M][U])+"px",l[V][K]=ie(l[D].S[K]+m[D][M][K])+"px",l[V][G]=ie(l[D].S[G]+m[D][M][G])+"px"):n())))}var l,m,t,v,h,x,g,c,d,b,w,y,S,E,T,L,N,I,C,i,r,a,s=!1,B=!1,P=!1,z=!1,O=!1,A=te===f?J:U,j=te===f?G:K,k=G===j?H:Q,R=ne===f?function(e,t,n,o){var i,r,a=t;if(O){if(n<0){for(r=e[Z],h===t&&(h=e),x===e&&(x=e[_]),g.insertBefore(e,t),e[D].index=t[D].index,e[D].prev.line=e[D].line,e[D].prev[K]=e[D][M][K],e[D].prev[G]=e[D][M][G],e[D].line=t[D].line,e[D][M][K]=t[D][M][K],e[D][M][G]=t[D][M][G],l[V][K]=ie(l[D].S[K]+e[D][M][K])+"px",l[V][G]=ie(l[D].S[G]+e[D][M][G])+"px";(i=t[Z])&&i!==r;)t[D].animation&&t[D].animation.stop(),t[D].index++,t[D].prev.line=t[D].line,t[D].prev[K]=t[D][M][K],t[D].prev[G]=t[D][M][G],t[D].line=i[D].line,t[D][M][K]=i[D][M][K],t[D][M][G]=i[D][M][G],t[V][K]=ie(t[D][M][K]-b[K]-t[D][W][K])+"px",t[V][G]=ie(t[D][M][G]-b[G]-t[D][W][G])+"px",t=i;t[D].animation&&t[D].animation.stop(),t[D].index++,t[D].prev.line=t[D].line,t[D].prev[K]=t[D][M][K],t[D].prev[G]=t[D][M][G],t[D].line=e[D].prev.line,t[D][M][K]=e[D].prev[K],t[D][M][G]=e[D].prev[G],t[V][K]=ie(t[D][M][K]-b[K]-t[D][W][K])+"px",t[V][G]=ie(t[D][M][G]-b[G]-t[D][W][G])+"px"}else if(0<n){for(r=e[Z],h===e&&(h=r),t[Z]?g.insertBefore(e,t[Z]):(g.appendChild(e),x=e),e[D].index=t[D].index,t=r,(i=e)[D].prev.line=i[D].line,i[D].prev[K]=i[D][M][K],i[D].prev[G]=i[D][M][G];t[D].animation&&t[D].animation.stop(),t[D].index--,t[D].prev.line=t[D].line,t[D].prev[K]=t[D][M][K],t[D].prev[G]=t[D][M][G],t[D].line=i[D].prev.line,t[D][M][K]=i[D].prev[K],t[D][M][G]=i[D].prev[G],t[V][K]=ie(t[D][M][K]-b[K]-t[D][W][K])+"px",t[V][G]=ie(t[D][M][G]-b[G]-t[D][W][G])+"px",(t=(i=t)[Z])&&t!==e;);e[D].line=i[D].prev.line,e[D][M][K]=i[D].prev[K],e[D][M][G]=i[D].prev[G],l[V][K]=ie(l[D].S[K]+e[D][M][K])+"px",l[V][G]=ie(l[D].S[G]+e[D][M][G])+"px"}ve(a,o,{top:a[D][M][K]-a[D].prev[K],left:a[D][M][G]-a[D].prev[G]})}else n<0?(i=e[_],r=t[_]||t,h===t&&(h=e),x===e&&(x=e[_]),g.insertBefore(e,t)):0<n&&(i=e[Z],r=e[_]||e[Z],h===e&&(h=e[Z]),t[Z]?g.insertBefore(e,t[Z]):(g.appendChild(e),x=e)),e[D].index=t[D].index,function(e,t,n){for(e=e[n<0?Z:_];e;){if(e[D].index+=n<0?1:-1,e===t)return;e=e[n<0?Z:_]}}(e,i,n),function(e,t,n,o,i,r,a,s){for(var p,l=0;e;)e[D].animation&&e[D].animation.stop(),p=e[D][W][r]+e[D][M][a]+e[D][W][s],0<l&&n[q][r]+l+p+n[q][s]>n[a]&&(t++,l=0),e[D].line=t,e[D].prev[r]=e[D][M][r],e[D][M][r]=n[r]+n[q][r]+l+e[D][W][r],e===o?i[V][r]=ie(i[D].S[r]+e[D][M][r])+"px":e[V][r]=ie(e[D][M][r]-e[D][W][r]-n[r])+"px",l+=p,e=e[Z]}(r=function(e,t){for(var n;(n=e[_])&&n[D].line>=t;)e=n;return e}(r,n=r[D].line),n,b,e,l,G,J,H),function(e,t,n,o,i,r,a,s){for(var p,l,c,d=e,u=e[D].line,f=0;e;)p=e[D].line,c=e[D][W][r]+e[D][M][a]+e[D][W][s],f=p===u?oe.max(f,c):(t[p]=t[u]+f,u=p,c),e=e[Z];for(0<f&&(t[u+1]=t[u]+f),e=d;e;){switch(l=t[p=e[D].line],e[D].prev[r]=e[D][M][r],e[D].$.verticalAlign){case"bottom":e[D][M][r]=n[r]+t[p+1]-e[D][M][a]-e[D][W][s];break;case"top":default:e[D][M][r]=n[r]+l+e[D][W][r]}e===o?i[V][r]=ie(i[D].S[r]+e[D][M][r])+"px":e[V][r]=ie(e[D][M][r]-e[D][W][r]-n[r])+"px",e=e[Z]}}(r,d,b,e,l,K,U,Q),ve(a,o,{top:a[D][M][K]-a[D].prev[K],left:a[D][M][G]-a[D].prev[G]})}:function(e,t,n,o){var i,r,a=t,s=0,p=0;if(n<0){for(r=e[Z],h===t&&(h=e),x===e&&(x=e[_]),g.insertBefore(e,t),e[D].index=t[D].index,e[D].prev[j]=e[D][M][j],p=e[D][W][j]-t[D][W][j],e[D][M][j]=t[D][M][j]+p,l[V][j]=ie(l[D].S[j]+e[D][M][j])+"px",s=e[D][M][A]-t[D][M][A],p+=e[D][W][k]-t[D][W][k];(i=t[Z])&&i!==r;)t[D].animation&&t[D].animation.stop(),t[D].index++,t[D].prev[j]=t[D][M][j],p+=t[D][W][j]-i[D][W][j],t[D][M][j]=i[D][M][j]+s+p,p+=t[D][W][k]-i[D][W][k],t[V][j]=ie(t[D][M][j]-b[j]-t[D][W][j])+"px",s+=t[D][M][A]-i[D][M][A],t=i;t[D].animation&&t[D].animation.stop(),t[D].index++,t[D].prev[j]=t[D][M][j],t[D][M][j]=e[D].prev[j]+s+p-e[D][W][j]+t[D][W][j],t[V][j]=ie(t[D][M][j]-b[j]-t[D][W][j])+"px"}else if(0<n){for(r=e[Z],h===e&&(h=r),t[Z]?g.insertBefore(e,t[Z]):(g.appendChild(e),x=e),e[D].index=t[D].index,t=r,s=p=0,(i=e)[D].prev[j]=i[D][M][j];t[D].animation&&t[D].animation.stop(),t[D].index--,t[D].prev[j]=t[D][M][j],p+=t[D][W][j]-i[D][W][j],t[D][M][j]=i[D].prev[j]+s+p,t[V][j]=ie(t[D][M][j]-b[j]-t[D][W][j])+"px",s+=-(i[D][M][A]-t[D][M][A]),p+=t[D][W][k]-i[D][W][k],(t=(i=t)[Z])&&t!==e;);e[D][M][j]=i[D].prev[j]+s+p-i[D][W][j]+e[D][W][j],l[V][j]=ie(l[D].S[j]+e[D][M][j])+"px"}(n={})[j]=a[D][M][j]-a[D].prev[j],ve(a,o,n)},$=ne===f?xe:he,F=(i=function(e){var t,n,o,i,r,a,s=0,p=K,l=U,c=G,d=J;ee===f&&(c=K,d=U),n=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientX,t=(e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e).clientY,o=n-T,i=t-L,m[D].r[K]=t-E+b[K]+m[D][W][K],m[D].r[G]=n-S+b[G]+m[D][W][G],r=m[D].r[G]+m[D].r[J]/2,a=m[D].r[K]+m[D].r[U]/2,e=m[D].r[c],r=ue(n,t).concat(ee===f?[]:ue(m[D].r[G]+2,a)).concat(ee===f?[]:ue(m[D].r[G]+m[D].r[J]-2,a)).concat(te===f?[]:ue(r,m[D].r[K]+2)).concat(te===f?[]:ue(r,m[D].r[K]+m[D].r[U]-2)).reduce(function(e,t){var n;return t!==m&&t.parentNode===g&&(n=$(m,t,j,A),s<n&&(s=n,e=t)),e},null),i=ne===f?(!r&&m!==h&&0<=h[D][M][c]-(e+m[D][M][d])&&h[D][M][c]-(e+m[D][M][d])<50&&.7<(s=he(m,h,p,l))&&(r=h),!r&&m!==x&&0<=e-(x[D][M][c]+x[D][M][d])&&e-(x[D][M][c]+x[D][M][d])<50&&.7<(s=he(m,x,p,l))&&(r=x),m[V][K]=ie(t-E)+"px",m[V][G]=ie(n-S)+"px",r?r[D].index-m[D].index:oe.abs(i)>=oe.abs(o)?i:o):(!r&&m!==h&&h[D][M][c]>e+m[D][M][d]&&(r=h),!r&&m!==x&&e>x[D][M][c]+x[D][M][d]&&(r=x),te===f?(m[V][j]=ie(n-S)+"px",o):(m[V][j]=ie(t-E)+"px",i)),v&&(N<0&&0<i&&I<.5||0<N&&i<0&&I<.5||r&&v!==r&&I<s||!$(m,v,j,A))&&(le(v,u.opts.closestItem||"dnd-sortable-closest"),I=0,v=null),!v&&r&&s&&(v=r,N=0<i?1:-1,I=s,C=!1),T=n,L=t,v&&((s=s||$(m,v,j,A))?.2<(I=s)?(pe(v,u.opts.closestItem||"dnd-sortable-closest"),.5<s&&!C&&(C=!0,R(m,v,N,u.opts.animationMs||0))):le(v,u.opts.closestItem||"dnd-sortable-closest"):(le(v,u.opts.closestItem||"dnd-sortable-closest"),I=0,v=null))},a=!(r=60),function(){var e=arguments;a||(i.apply(this,e),a=!0,setTimeout(function(){a=!1},r))}),X=function(e){var t=m;o(),n(),"function"==typeof u.opts.onEnd&&u.opts.onEnd(t)};u.start=u.opts.callable?function(){B||(B=!(s=!1),u.handle=e)}:function(){B||(B=!0,s||(ce(Y,"touchstart",e,{capture:s=!0,passive:!1}),ce(Y,"mousedown",e,{capture:!0,passive:!1})))},u.stop=function(){u.handle=null,B=!1,s&&(p(Y,"touchstart",e,{capture:!(s=!1),passive:!1}),p(Y,"mousedown",e,{capture:!0,passive:!1})),o(),n()}}function a(e,t){var n=this;if(!(n instanceof a))return new a(e,t);switch(n.opts=t||{},(e=ie(e)).toLowerCase()){case"unrestricted":r(n,ne);break;case"horizontal":r(n,te);break;case"vertical":r(n,ee);break;default:throw new TypeError("AreaSortable invalid sort mode:"+e)}n.start()}return window.Element&&!o.call(window.Element.prototype,D)&&(window.Element.prototype[D]=null),a.VERSION="1.1.0",a.prototype={constructor:a,opts:null,start:null,handle:null,stop:null,dispose:function(){var e=this;return e.stop&&e.stop(),e.opts=null,e.start=null,e.handle=null,e.stop=null,e}},a});